<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CD Tracker</title>
<style>
body {
  margin: 0;
  background: #0d0f14;
  color: #e5e7eb;
  font-family: system-ui, -apple-system, sans-serif;
}

.container {
  padding: 6px;
}

.enemy {
  background: #161a22;
  padding: 6px 8px;
  margin-bottom: 6px;
  border-radius: 6px;
  font-size: 13px;
}

.top-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.name {
  width: 42px;
  background: transparent;
  border: none;
  color: white;
  font-weight: bold;
  font-size: 13px;
}

.level {
  display: flex;
  align-items: center;
  gap: 4px;
}

.level button {
  background: #232834;
  border: none;
  color: white;
  font-size: 12px;
  padding: 2px 6px;
  border-radius: 4px;
}

.toggles {
  display: flex;
  gap: 6px;
  font-size: 11px;
}

.toggle {
  cursor: pointer;
  opacity: 0.4;
}

.toggle.active {
  opacity: 1;
  color: #22c55e;
}

.spell-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 4px;
}

.spell-name {
  cursor: pointer;
  font-weight: 500;
  width: 70px;
}

.timer {
  cursor: pointer;
  font-weight: bold;
}

.ready {
  color: #22c55e;
}

.active {
  color: #ef4444;
}
</style>
</head>
<body>
<div class="container" id="app"></div>

<script>
const spellList = [
  { name: "Flash", cd: 300 },
  { name: "Ignite", cd: 180 },
  { name: "Teleport", cd: 0 },
  { name: "Heal", cd: 240 },
  { name: "Exhaust", cd: 240 },
  { name: "Ghost", cd: 210 },
  { name: "Cleanse", cd: 210 },
  { name: "Smite", cd: 90 }
];

function teleportBase(level) {
  if (level <= 6) return 360;
  if (level <= 10) return 300;
  return 240;
}

function adjustedCooldown(base, haste) {
  return Math.round(base * (100 / (100 + haste)));
}

function formatTime(s) {
  const m = Math.floor(s / 60).toString().padStart(2,'0');
  const sec = (s % 60).toString().padStart(2,'0');
  return `${m}:${sec}`;
}

class SpellTimer {
  constructor() {
    this.remaining = 0;
    this.interval = null;
  }

  start(duration, update) {
    this.remaining = duration;
    clearInterval(this.interval);
    this.interval = setInterval(() => {
      if (this.remaining > 0) {
        this.remaining--;
        update();
      } else {
        clearInterval(this.interval);
        update();
      }
    }, 1000);
  }

  reset(update) {
    clearInterval(this.interval);
    this.remaining = 0;
    update();
  }
}

function createEnemy(i) {
  let level = 1;
  let boots = false;
  let cosmic = false;
  let crimson = false;

  let spellIndex1 = 0;
  let spellIndex2 = 1;

  const timer1 = new SpellTimer();
  const timer2 = new SpellTimer();

  const enemy = document.createElement("div");
  enemy.className = "enemy";

  enemy.innerHTML = `
    <div class="top-row">
      <input class="name" maxlength="3" value="E${i}">
      <div class="level">
        <button class="minus">-</button>
        <span class="lvl">L1</span>
        <button class="plus">+</button>
      </div>
      <div class="toggles">
        <span class="toggle boots">ION</span>
        <span class="toggle cosmic">COS</span>
        <span class="toggle crimson">CRI</span>
      </div>
    </div>

    <div class="spell-row">
      <span class="spell-name s1"></span>
      <span class="timer t1 ready">Ready</span>
    </div>

    <div class="spell-row">
      <span class="spell-name s2"></span>
      <span class="timer t2 ready">Ready</span>
    </div>
  `;

  const lvlSpan = enemy.querySelector(".lvl");
  const s1 = enemy.querySelector(".s1");
  const s2 = enemy.querySelector(".s2");
  const t1 = enemy.querySelector(".t1");
  const t2 = enemy.querySelector(".t2");

  function haste() {
    return (boots ? 10 : 0) +
           (cosmic ? 18 : 0) +
           (crimson ? 12 : 0);
  }

  function getCD(spell) {
    const base = spell.name === "Teleport"
      ? teleportBase(level)
      : spell.cd;
    return adjustedCooldown(base, haste());
  }

  function updateDisplay(timer, element) {
    if (timer.remaining > 0) {
      element.textContent = formatTime(timer.remaining);
      element.className = "timer active";
    } else {
      element.textContent = "Ready";
      element.className = "timer ready";
    }
  }

  function updateSpellNames() {
    s1.textContent = spellList[spellIndex1].name;
    s2.textContent = spellList[spellIndex2].name;
  }

  enemy.querySelector(".minus").onpointerdown = () => {
    if (level > 1) level--;
    lvlSpan.textContent = "L" + level;
  };

  enemy.querySelector(".plus").onpointerdown = () => {
    if (level < 18) level++;
    lvlSpan.textContent = "L" + level;
  };

  function toggle(el, setter) {
    el.onpointerdown = () => {
      setter();
      el.classList.toggle("active");
    };
  }

  toggle(enemy.querySelector(".boots"), () => boots = !boots);
  toggle(enemy.querySelector(".cosmic"), () => cosmic = !cosmic);
  toggle(enemy.querySelector(".crimson"), () => crimson = !crimson);

  s1.onpointerdown = () => {
    spellIndex1 = (spellIndex1 + 1) % spellList.length;
    updateSpellNames();
  };

  s2.onpointerdown = () => {
    spellIndex2 = (spellIndex2 + 1) % spellList.length;
    updateSpellNames();
  };

  t1.onpointerdown = () => {
    if (timer1.remaining > 0) {
      timer1.reset(() => updateDisplay(timer1, t1));
    } else {
      timer1.start(
        getCD(spellList[spellIndex1]),
        () => updateDisplay(timer1, t1)
      );
    }
  };

  t2.onpointerdown = () => {
    if (timer2.remaining > 0) {
      timer2.reset(() => updateDisplay(timer2, t2));
    } else {
      timer2.start(
        getCD(spellList[spellIndex2]),
        () => updateDisplay(timer2, t2)
      );
    }
  };

  updateSpellNames();
  return enemy;
}

const app = document.getElementById("app");
for (let i = 1; i <= 5; i++) {
  app.appendChild(createEnemy(i));
}
</script>
</body>
</html>
